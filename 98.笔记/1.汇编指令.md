
[汇编指令](https://baike.baidu.com/item/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/9979890?fr=aladdin)

# 一、顶层规划

以项目的形式来促进汇编指令的掌握。

1. 第一问：ucore 中使用了哪些汇编指令？

# 二、ucore 中使用的汇编指令

[了解处理器硬件](https://objectkuan.gitbooks.io/ucore-docs/content/lab0/lab0_2_5_cpu_hardware.html)

[Intel 80386 Reference Programmers Manual-i386]()

[Intel 80386 Reference Programmer's Manual Table of Contents](https://nju-projectn.github.io/i386-manual/toc.htm)

## 逻辑运算类指令

- or：或运算；
- xor：异或运算；
- test：测试；（两操作数作与运算，仅修改标志位，不回送结果）
- jne/jnz：不等于时转移；

## 数据传送指令

- mov：传送字或字节；

## 输入输出端口传送指令

- in：I/O 端口输入；
- out：I/O 端口输出；
- ins：串输入指令；

## 处理机控制指令

- cld：方向标志位置 0 指令；
- cli：中断标志置 0 指令；

## 无条件转移指令

- jmp：无条件转移指令；
- call：过程调用；

## 条件转移指令

- ljmp：将处理器切换到 32 位模式，以 32 位模式进行跳转；

# 三、寄存器

- al：累加器；
- eax：32 位累加器；

## 状态和控制寄存器组

### 32 位的控制寄存器

- CR0
    - 包含了 6 个预定义标志；
    - 0 位是 `保护允许位 PE (Protedted Enable)`；
        - 用于启动保护模式；
        - PE = 1，保护模式启动；
        - PE = 0，在实模式下运行；
    - 1 位是 `监控协处理位 MP (Moniter coprocessor)`；
        - 它与第 3 位一起决定；
        - TS = 1，操作码 WAIT 产生一个协处理器不能使用的出错信号；
    - 2 位是 `模拟协处理器位 EM (Emulate coprocessor)`；
        - EM = 1，不能使用协处理器；
        - EM = 0，允许使用协处理器；
    - 3 位是 `任务转换位 (Task Switch)`；
        - 当一个任务转换完成之后，自动将它置 1；
        - TS = 1，就不能使用协处理器；
    - 4 位是 `微处理器的扩展类型位 ET (Processor Extension Type)`；
        - 其内保存着处理器扩展类型的信息；
        - ET = 0，标识系统使用的是 287 协处理器；
        - ET = 1，表示系统使用的是 387 浮点协处理器；
    - 31 位是 `分页允许位(Paging Enable)`；
        - 它表示芯片上的分页部件是否允许工作。
- CR1
    - 未定义的控制寄存器，供将来的处理器使用；
- CR2
    - 页故障线性地址寄存器，保存最后一次出现页故障的全 32 位线性地址；
- CR3
    - 页目录基址寄存器，保存页目录表的物理地址；
    - 页目录表总是放在以 4K 字节为单位的存储器边界上；
    - 它的地址的低12位总为0，不起作用，即使写上内容，也不会被理会。

这几个寄存器中保存 `全局性` 和 `任务无关` 的机器状态。

这几个寄存器是与 `分页机制` 密切相关的，因此，在进程管理及虚拟内存管理中会涉及到这几个寄存器，要记住 CR0、CR2、CR3 这 3 个寄存器的内容。

- esp
    - 寄存器存放当前线程的栈顶指针；
- ebp
    - 寄存器存放当前线程的栈底指针；
- eip
    - 寄存器存放下一个 CPU 指令存放的内存地址；
    - 当 CPU 执行完当前的指令后，从 eip 寄存器中读取下一条指令的内存地址，然后继续执行。